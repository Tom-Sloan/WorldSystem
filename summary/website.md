# Website - React-based 3D Visualization Frontend

## Overview

The website service is a modern React application that provides real-time 3D visualization and control interface for the WorldSystem project. Built with React Three Fiber (R3F) and Three.js, it offers an immersive way to view reconstructed 3D room models, drone telemetry, and live video streams. The application supports both desktop and VR/AR experiences through WebXR.

## What This Service Does

### Core Functionality
- **3D Model Visualization**: Renders OBJ/MTL room models generated by the reconstruction pipeline
- **Real-time Video Streaming**: Displays live H.264 video feed from the drone
- **Trajectory Visualization**: Shows drone flight paths and orientation in 3D space
- **WebSocket Communication**: Maintains real-time bidirectional connection with the server
- **WebXR Support**: Enables VR/AR experiences for immersive room exploration
- **Interactive Controls**: Provides UI for frame processor configuration and system control

### Key Features
- Tab-based interface with multiple visualization modes
- Floating video overlay in 3D scene view
- ViewCube for intuitive 3D navigation
- Responsive design with mobile support
- Context-based WebSocket message distribution
- Automatic reconnection with exponential backoff

## System Architecture Connection

### Data Flow
```
Server (WebSocket)
    ↓ ws://host/ws/viewer
Website (React App)
    ├── 3D Scene (Three.js)
    ├── Video Stream
    ├── Trajectory Data
    └── Control Commands
```

### Communication Protocol
- **WebSocket Endpoint**: `/ws/viewer` for bidirectional communication
- **Message Types**:
  - `video_frame`: H.264 encoded video frames
  - `slam_update`: Camera poses and point clouds
  - `mesh_update`: 3D mesh data
  - `control_command`: User interface controls

### Integration Points
1. **Server WebSocket**: Real-time data streaming
2. **OBJ/MTL Models**: Loaded from server API endpoints
3. **Video Stream**: H.264 frames decoded and displayed
4. **Control Messages**: Sent to server for system configuration

## Development History

### Project Evolution
The website evolved from a simple visualization tool to a comprehensive 3D interface:

1. **Initial Development**
   - Basic Three.js integration
   - Simple OBJ model loading
   - Static camera controls

2. **React Three Fiber Migration**
   - Adopted R3F for better React integration
   - Component-based 3D scene management
   - Improved performance with React optimizations

3. **WebSocket Integration**
   - Implemented context-based message distribution
   - Added automatic reconnection logic
   - Pub/sub pattern for component communication

4. **UI Enhancement**
   - Added Shadcn/ui component library
   - Implemented sidebar navigation
   - Tab-based view switching

5. **WebXR Addition**
   - VR support through WebXR API
   - Immersive mode for room exploration
   - Barebones VR component for testing

### Recent Updates
- Floating video overlay in 3D scene
- ViewCube for intuitive navigation
- Multiple visualization modes (trajectory, orientation, time steps)
- Improved WebSocket reliability

## Technical Details

### Technology Stack
- **Framework**: React 18.3.1
- **3D Engine**: Three.js with React Three Fiber
- **UI Components**: Shadcn/ui, Radix UI
- **Styling**: Tailwind CSS
- **Build Tool**: Vite
- **State Management**: React Context (WebSocket)
- **WebXR**: @react-three/xr for VR/AR support

### Project Structure
```
website/
├── src/
│   ├── App.jsx              # Main application component
│   ├── contexts/            # WebSocket context
│   ├── components/          # UI components
│   ├── RoomModel.jsx        # 3D room visualization
│   ├── VideoStream.jsx      # Live video display
│   ├── TrajectoryVisualization.jsx
│   ├── OrientationVisualization.jsx
│   ├── TimeSteps.jsx
│   ├── ViewCube.jsx         # 3D navigation cube
│   └── BarebonesVR.jsx      # VR testing component
├── public/
│   └── models/              # Static 3D assets
└── package.json
```

### Key Components

1. **App.jsx**
   - Main application orchestrator
   - WebSocket connection management
   - Tab-based navigation
   - XR session handling

2. **WebSocketContext**
   - Centralized WebSocket management
   - Pub/sub message distribution
   - Connection state handling

3. **RoomModel.jsx**
   - OBJ/MTL model loading
   - Material and opacity controls
   - ForwardRef for external control

4. **VideoStream.jsx**
   - H.264 video decoding
   - Canvas-based rendering
   - Frame rate optimization

5. **ViewCube.jsx**
   - 3D navigation interface
   - Model rotation control
   - Visual orientation feedback

### Configuration
- **Environment Variables**:
  - `VITE_API_URL`: Backend API endpoint
  - `VITE_WS_URL`: WebSocket server URL
- **Build Configuration**: Vite with React plugin
- **Port**: Development server on 3001

## Challenges and Solutions

1. **WebSocket Reliability**
   - Challenge: Connection drops and message loss
   - Solution: Context-based management with auto-reconnection

2. **3D Performance**
   - Challenge: Large model rendering performance
   - Solution: LOD (Level of Detail), instancing, optimization

3. **Video Streaming Latency**
   - Challenge: Real-time video display with low latency
   - Solution: Canvas-based rendering, frame skipping

4. **Cross-browser Compatibility**
   - Challenge: WebXR support varies across browsers
   - Solution: Feature detection and graceful degradation

5. **State Management**
   - Challenge: Complex state across multiple visualization modes
   - Solution: React Context for WebSocket, local state for UI

## Features and Capabilities

### Visualization Modes
1. **3D Scene**: Interactive room model with drone position
2. **Video Stream**: Full-screen live video feed
3. **Trajectory**: 3D path visualization
4. **Orientation**: Drone attitude visualization
5. **Time Steps**: Temporal data exploration
6. **VR Mode**: Immersive room exploration

### User Interface
- Collapsible sidebar navigation
- Floating video overlay
- Interactive controls (Leva)
- Responsive design
- Dark theme support

### Future Enhancements
- Multi-room support
- Collaborative viewing
- AR mode for mobile devices
- Point cloud visualization
- Real-time mesh updates
- Recording and playback
- Measurement tools
- Annotation system